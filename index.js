const dayjs = require("dayjs");
const timezone = require("dayjs/plugin/timezone");
const utc = require("dayjs/plugin/utc");
dayjs.extend(utc);
dayjs.extend(timezone);


const testDatesMap = () => {
  // dates en UTC
  const testDates = [
    // "2024-03-10T00:00:00+00:00",
  // "2024-04-20T00:00:00+00:00",
  // "2025-03-10T00:00:00+00:00",
  // "2025-04-20T00:00:00+00:00",
  // "skip",
  "2025-03-23T01:00:00+00:00",
  "2025-03-23T02:00:00+00:00",
  "2025-03-23T02:01:00+00:00",
  "2025-03-23T02:02:00+00:00",
  "2025-03-23T02:03:00+00:00",
  "2025-03-23T02:04:00+00:00",
  "2025-03-23T02:05:00+00:00",
  "2025-03-23T02:06:00+00:00",
  "2025-03-23T02:07:00+00:00",
  "2025-03-23T02:08:00+00:00",
  "2025-03-23T02:09:00+00:00",
  "2025-03-23T02:10:00+00:00",
  "2025-03-23T02:11:00+00:00",
  "2025-03-23T02:12:00+00:00",
  "2025-03-23T02:13:00+00:00",
  "2025-03-23T02:14:00+00:00",
  "2025-03-23T02:15:00+00:00",
  "2025-03-23T02:16:00+00:00",
  "2025-03-23T02:17:00+00:00",
  "2025-03-23T02:18:00+00:00",
  "2025-03-23T02:19:00+00:00",
  "2025-03-23T02:20:00+00:00",
  "2025-03-23T02:21:00+00:00",
  "2025-03-23T02:22:00+00:00",
  "2025-03-23T02:23:00+00:00",
  "2025-03-23T02:24:00+00:00",
  "2025-03-23T02:25:00+00:00",
  "2025-03-23T02:26:00+00:00",
  "2025-03-23T02:27:00+00:00",
  "2025-03-23T02:28:00+00:00",
  "2025-03-23T02:29:00+00:00",
  "2025-03-23T02:30:00+00:00",
  "2025-03-23T02:31:00+00:00",
  "2025-03-23T02:32:00+00:00",
  "2025-03-23T02:33:00+00:00",
  "2025-03-23T02:34:00+00:00",
  "2025-03-23T02:35:00+00:00",
  "2025-03-23T02:36:00+00:00",
  "2025-03-23T02:37:00+00:00",
  "2025-03-23T02:38:00+00:00",
  "2025-03-23T02:39:00+00:00",
  "2025-03-23T02:40:00+00:00",
  "2025-03-23T02:41:00+00:00",
  "2025-03-23T02:42:00+00:00",
  "2025-03-23T02:43:00+00:00",
  "2025-03-23T02:44:00+00:00",
  "2025-03-23T02:45:00+00:00",
  "2025-03-23T02:46:00+00:00",
  "2025-03-23T02:47:00+00:00",
  "2025-03-23T02:48:00+00:00",
  "2025-03-23T02:49:00+00:00",
  "2025-03-23T02:50:00+00:00",
  "2025-03-23T02:51:00+00:00",
  "2025-03-23T02:52:00+00:00",
  "2025-03-23T02:53:00+00:00",
  "2025-03-23T02:54:00+00:00",
  "2025-03-23T02:55:00+00:00",
  "2025-03-23T02:56:00+00:00",
  "2025-03-23T02:57:00+00:00",
  "2025-03-23T02:58:00+00:00",
  "2025-03-23T02:59:00+00:00",
  "2025-03-23T03:00:00+00:00",
  "2025-03-23T03:01:00+00:00",
  "2025-03-23T03:02:00+00:00",
  "2025-03-23T03:03:00+00:00",
  "2025-03-23T03:04:00+00:00",
  "2025-03-23T03:05:00+00:00",
  "2025-03-23T03:06:00+00:00",
  "2025-03-23T03:07:00+00:00",
  "2025-03-23T03:08:00+00:00",
  "2025-03-23T03:09:00+00:00",
  "2025-03-23T03:10:00+00:00",
  "2025-03-23T03:11:00+00:00",
  "2025-03-23T03:12:00+00:00",
  "2025-03-23T03:13:00+00:00",
  "2025-03-23T03:14:00+00:00",
  "2025-03-23T03:15:00+00:00",
  "2025-03-23T03:16:00+00:00",
  "2025-03-23T03:17:00+00:00",
  "2025-03-23T03:18:00+00:00",
  "2025-03-23T03:19:00+00:00",
  "2025-03-23T03:20:00+00:00",
  "2025-03-23T03:21:00+00:00",
  "2025-03-23T03:22:00+00:00",
  "2025-03-23T03:23:00+00:00",
  "2025-03-23T03:24:00+00:00",
  "2025-03-23T03:25:00+00:00",
  "2025-03-23T03:26:00+00:00",
  "2025-03-23T03:27:00+00:00",
  "2025-03-23T03:28:00+00:00",
  "2025-03-23T03:29:00+00:00",
  "2025-03-23T03:30:00+00:00",
  "2025-03-23T03:31:00+00:00",
  "2025-03-23T03:32:00+00:00",
  "2025-03-23T03:33:00+00:00",
  "2025-03-23T03:34:00+00:00",
  "2025-03-23T03:35:00+00:00",
  "2025-03-23T03:36:00+00:00",
  "2025-03-23T03:37:00+00:00",
  "2025-03-23T03:38:00+00:00",
  "2025-03-23T03:39:00+00:00",
  "2025-03-23T03:40:00+00:00",
  "2025-03-23T03:41:00+00:00",
  "2025-03-23T03:42:00+00:00",
  "2025-03-23T03:43:00+00:00",
  "2025-03-23T03:44:00+00:00",
  "2025-03-23T03:45:00+00:00",
  "2025-03-23T03:46:00+00:00",
  "2025-03-23T03:47:00+00:00",
  "2025-03-23T03:48:00+00:00",
  "2025-03-23T03:49:00+00:00",
  "2025-03-23T03:50:00+00:00",
  "2025-03-23T03:51:00+00:00",
  "2025-03-23T03:52:00+00:00",
  "2025-03-23T03:53:00+00:00",
  "2025-03-23T03:54:00+00:00",
  "2025-03-23T03:55:00+00:00",
  "2025-03-23T03:56:00+00:00",
  "2025-03-23T03:57:00+00:00",
  "2025-03-23T03:58:00+00:00",
  "2025-03-23T03:59:00+00:00",
  "2025-03-23T04:00:00+00:00",
  "2025-03-23T04:01:00+00:00",
  "2025-03-23T04:02:00+00:00",
  "2025-03-23T04:03:00+00:00",
  "2025-03-23T04:04:00+00:00",
  "2025-03-23T04:05:00+00:00",
  "2025-03-23T04:06:00+00:00",
  "2025-03-23T04:07:00+00:00",
  "2025-03-23T04:08:00+00:00",
  "2025-03-23T04:09:00+00:00",
  "2025-03-23T04:10:00+00:00",
  "2025-03-23T04:11:00+00:00",
  "2025-03-23T04:12:00+00:00",
  "2025-03-23T04:13:00+00:00",
  "2025-03-23T04:14:00+00:00",
  "2025-03-23T04:15:00+00:00",
  "2025-03-23T04:16:00+00:00",
  "2025-03-23T04:17:00+00:00",
  "2025-03-23T04:18:00+00:00",
  "2025-03-23T04:19:00+00:00",
  "2025-03-23T04:20:00+00:00",
  "2025-03-23T04:21:00+00:00",
  "2025-03-23T04:22:00+00:00",
  "2025-03-23T04:23:00+00:00",
  "2025-03-23T04:24:00+00:00",
  "2025-03-23T04:25:00+00:00",
  "2025-03-23T04:26:00+00:00",
  "2025-03-23T04:27:00+00:00",
  "2025-03-23T04:28:00+00:00",
  "2025-03-23T04:29:00+00:00",
  "2025-03-23T04:30:00+00:00",
  "2025-03-23T04:31:00+00:00",
  "2025-03-23T04:32:00+00:00",
  "2025-03-23T04:33:00+00:00",
  "2025-03-23T04:34:00+00:00",
  "2025-03-23T04:35:00+00:00",
  "2025-03-23T04:36:00+00:00",
  "2025-03-23T04:37:00+00:00",
  "2025-03-23T04:38:00+00:00",
  "2025-03-23T04:39:00+00:00",
  "2025-03-23T04:40:00+00:00",
  "2025-03-23T04:41:00+00:00",
  "2025-03-23T04:42:00+00:00",
  "2025-03-23T04:43:00+00:00",
  "2025-03-23T04:44:00+00:00",
  "2025-03-23T04:45:00+00:00",
  "2025-03-23T04:46:00+00:00",
  "2025-03-23T04:47:00+00:00",
  "2025-03-23T04:48:00+00:00",
  "2025-03-23T04:49:00+00:00",
  "2025-03-23T04:50:00+00:00",
  "2025-03-23T04:51:00+00:00",
  "2025-03-23T04:52:00+00:00",
  "2025-03-23T04:53:00+00:00",
  "2025-03-23T04:54:00+00:00",
  "2025-03-23T04:55:00+00:00",
  "2025-03-23T04:56:00+00:00",
  "2025-03-23T04:57:00+00:00",
  "2025-03-23T04:58:00+00:00",
  "2025-03-23T04:59:00+00:00",
  "2025-03-23T05:00:00+00:00",
];

const expectedDates = [
  "2025-03-22T22:00:00-03:00",
  "2025-03-22T23:00:00-03:00",
  "2025-03-22T23:01:00-03:00",
  "2025-03-22T23:02:00-03:00",
  "2025-03-22T23:03:00-03:00",
  "2025-03-22T23:04:00-03:00",
  "2025-03-22T23:05:00-03:00",
  "2025-03-22T23:06:00-03:00",
  "2025-03-22T23:07:00-03:00",
  "2025-03-22T23:08:00-03:00",
  "2025-03-22T23:09:00-03:00",
  "2025-03-22T23:10:00-03:00",
  "2025-03-22T23:11:00-03:00",
  "2025-03-22T23:12:00-03:00",
  "2025-03-22T23:13:00-03:00",
  "2025-03-22T23:14:00-03:00",
  "2025-03-22T23:15:00-03:00",
  "2025-03-22T23:16:00-03:00",
  "2025-03-22T23:17:00-03:00",
  "2025-03-22T23:18:00-03:00",
  "2025-03-22T23:19:00-03:00",
  "2025-03-22T23:20:00-03:00",
  "2025-03-22T23:21:00-03:00",
  "2025-03-22T23:22:00-03:00",
  "2025-03-22T23:23:00-03:00",
  "2025-03-22T23:24:00-03:00",
  "2025-03-22T23:25:00-03:00",
  "2025-03-22T23:26:00-03:00",
  "2025-03-22T23:27:00-03:00",
  "2025-03-22T23:28:00-03:00",
  "2025-03-22T23:29:00-03:00",
  "2025-03-22T23:30:00-03:00",
  "2025-03-22T23:31:00-03:00",
  "2025-03-22T23:32:00-03:00",
  "2025-03-22T23:33:00-03:00",
  "2025-03-22T23:34:00-03:00",
  "2025-03-22T23:35:00-03:00",
  "2025-03-22T23:36:00-03:00",
  "2025-03-22T23:37:00-03:00",
  "2025-03-22T23:38:00-03:00",
  "2025-03-22T23:39:00-03:00",
  "2025-03-22T23:40:00-03:00",
  "2025-03-22T23:41:00-03:00",
  "2025-03-22T23:42:00-03:00",
  "2025-03-22T23:43:00-03:00",
  "2025-03-22T23:44:00-03:00",
  "2025-03-22T23:45:00-03:00",
  "2025-03-22T23:46:00-03:00",
  "2025-03-22T23:47:00-03:00",
  "2025-03-22T23:48:00-03:00",
  "2025-03-22T23:49:00-03:00",
  "2025-03-22T23:50:00-03:00",
  "2025-03-22T23:51:00-03:00",
  "2025-03-22T23:52:00-03:00",
  "2025-03-22T23:53:00-03:00",
  "2025-03-22T23:54:00-03:00",
  "2025-03-22T23:55:00-03:00",
  "2025-03-22T23:56:00-03:00",
  "2025-03-22T23:57:00-03:00",
  "2025-03-22T23:58:00-03:00",
  "2025-03-22T23:59:00-03:00",
  "2025-03-23T00:00:00-03:00",
  "2025-03-23T00:01:00-03:00",
  "2025-03-23T00:02:00-03:00",
  "2025-03-23T00:03:00-03:00",
  "2025-03-23T00:04:00-03:00",
  "2025-03-23T00:05:00-03:00",
  "2025-03-23T00:06:00-03:00",
  "2025-03-23T00:07:00-03:00",
  "2025-03-23T00:08:00-03:00",
  "2025-03-23T00:09:00-03:00",
  "2025-03-23T00:10:00-03:00",
  "2025-03-23T00:11:00-03:00",
  "2025-03-23T00:12:00-03:00",
  "2025-03-23T00:13:00-03:00",
  "2025-03-23T00:14:00-03:00",
  "2025-03-23T00:15:00-03:00",
  "2025-03-23T00:16:00-03:00",
  "2025-03-23T00:17:00-03:00",
  "2025-03-23T00:18:00-03:00",
  "2025-03-23T00:19:00-03:00",
  "2025-03-23T00:20:00-03:00",
  "2025-03-23T00:21:00-03:00",
  "2025-03-23T00:22:00-03:00",
  "2025-03-23T00:23:00-03:00",
  "2025-03-23T00:24:00-03:00",
  "2025-03-23T00:25:00-03:00",
  "2025-03-23T00:26:00-03:00",
  "2025-03-23T00:27:00-03:00",
  "2025-03-23T00:28:00-03:00",
  "2025-03-23T00:29:00-03:00",
  "2025-03-23T00:30:00-03:00",
  "2025-03-23T00:31:00-03:00",
  "2025-03-23T00:32:00-03:00",
  "2025-03-23T00:33:00-03:00",
  "2025-03-23T00:34:00-03:00",
  "2025-03-23T00:35:00-03:00",
  "2025-03-23T00:36:00-03:00",
  "2025-03-23T00:37:00-03:00",
  "2025-03-23T00:38:00-03:00",
  "2025-03-23T00:39:00-03:00",
  "2025-03-23T00:40:00-03:00",
  "2025-03-23T00:41:00-03:00",
  "2025-03-23T00:42:00-03:00",
  "2025-03-23T00:43:00-03:00",
  "2025-03-23T00:44:00-03:00",
  "2025-03-23T00:45:00-03:00",
  "2025-03-23T00:46:00-03:00",
  "2025-03-23T00:47:00-03:00",
  "2025-03-23T00:48:00-03:00",
  "2025-03-23T00:49:00-03:00",
  "2025-03-23T00:50:00-03:00",
  "2025-03-23T00:51:00-03:00",
  "2025-03-23T00:52:00-03:00",
  "2025-03-23T00:53:00-03:00",
  "2025-03-23T00:54:00-03:00",
  "2025-03-23T00:55:00-03:00",
  "2025-03-23T00:56:00-03:00",
  "2025-03-23T00:57:00-03:00",
  "2025-03-23T00:58:00-03:00",
  "2025-03-23T00:59:00-03:00",
  "2025-03-23T01:00:00-03:00",
  "2025-03-23T01:01:00-03:00",
  "2025-03-23T01:02:00-03:00",
  "2025-03-23T01:03:00-03:00",
  "2025-03-23T01:04:00-03:00",
  "2025-03-23T01:05:00-03:00",
  "2025-03-23T01:06:00-03:00",
  "2025-03-23T01:07:00-03:00",  
  "2025-03-23T01:08:00-03:00",
  "2025-03-23T01:09:00-03:00",
  "2025-03-23T01:10:00-03:00",
  "2025-03-23T01:11:00-03:00",
  "2025-03-23T01:12:00-03:00",
  "2025-03-23T01:13:00-03:00",
  "2025-03-23T01:14:00-03:00",
  "2025-03-23T01:15:00-03:00",
  "2025-03-23T01:16:00-03:00",
  "2025-03-23T01:17:00-03:00",
  "2025-03-23T01:18:00-03:00",
  "2025-03-23T01:19:00-03:00",
  "2025-03-23T01:20:00-03:00",
  "2025-03-23T01:21:00-03:00",
  "2025-03-23T01:22:00-03:00",
  "2025-03-23T01:23:00-03:00",
  "2025-03-23T01:24:00-03:00",
  "2025-03-23T01:25:00-03:00",
  "2025-03-23T01:26:00-03:00",
  "2025-03-23T01:27:00-03:00",
  "2025-03-23T01:28:00-03:00",
  "2025-03-23T01:29:00-03:00",
  "2025-03-23T01:30:00-03:00",
  "2025-03-23T01:31:00-03:00",
  "2025-03-23T01:32:00-03:00",
  "2025-03-23T01:33:00-03:00",
  "2025-03-23T01:34:00-03:00",
  "2025-03-23T01:35:00-03:00",
  "2025-03-23T01:36:00-03:00",
  "2025-03-23T01:37:00-03:00",
  "2025-03-23T01:38:00-03:00",
  "2025-03-23T01:39:00-03:00",
  "2025-03-23T01:40:00-03:00",
  "2025-03-23T01:41:00-03:00",
  "2025-03-23T01:42:00-03:00",
  "2025-03-23T01:43:00-03:00",
  "2025-03-23T01:44:00-03:00",
  "2025-03-23T01:45:00-03:00",
  "2025-03-23T01:46:00-03:00",
  "2025-03-23T01:47:00-03:00",
  "2025-03-23T01:48:00-03:00",
  "2025-03-23T01:49:00-03:00",
  "2025-03-23T01:50:00-03:00",
  "2025-03-23T01:51:00-03:00",
  "2025-03-23T01:52:00-03:00",
  "2025-03-23T01:53:00-03:00",
  "2025-03-23T01:54:00-03:00",
  "2025-03-23T01:55:00-03:00",
  "2025-03-23T01:56:00-03:00",
  "2025-03-23T01:57:00-03:00",
  "2025-03-23T01:58:00-03:00",
  "2025-03-23T01:59:00-03:00",
  "2025-03-23T02:00:00-03:00",
];

// console.table(
  testDates.map((date, index) => {
    console.debug('string date\t\t', date);
    const result = dayjs(date).tz("America/Asuncion").format();
    console.debug('result\t\t\t', result, 
      expectedDates[index] === result? 'OK' : '\x1b[31m ERROR \x1b[0m');
    console.debug('\n');
  })
// );
}

// testDatesMap();


const testFeeExpiration = () => {
    const now = dayjs('2025-04-19').startOf('day');
    console.log('now', now.format('YYYY-MM-DD HH:mm:ss Z'));

    const dueDate1 = dayjs('2025-04-19T03:00:00.000+00:00').tz('America/Asuncion').startOf('day');
    console.log('dueDate1', dueDate1.format('YYYY-MM-DD HH:mm:ss Z'));

    const dueDate2 = dayjs('2025-04-19T04:00:00.000+00:00').tz('America/Asuncion').startOf('day');
    console.log('dueDate2', dueDate2.format('YYYY-MM-DD HH:mm:ss Z'));

    console.log('test A', dueDate1.diff(now, 'day'));
    console.log('test B', dueDate2.diff(now, 'day'));

    // loan dueDate search loan notifications
    const dueDate = dayjs.tz('2025-04-04').add(3, 'day').startOf('day').toDate();
    console.log('dueDate', dueDate);
    
}

testFeeExpiration();
